
<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<title>局点问题跟踪列表</title>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="/static/css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/css/bootstrap-select.min.css">
	<link rel="stylesheet" href="/static/css/style.css">

	<script src="/static/js/jquery-2.1.3.min.js"></script>
	<!-- Latest compiled and minified JavaScript -->
	<script src="/static/js/bootstrap.min.js"></script>

</head>

<body>

	<!-- nav -->
	<nav class="navbar navbar-default navbar-static-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="#">局点问题跟踪列表</a>
			</div>

			<ul class="nav navbar-nav">
				<li class="dropdown active">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
						{% if team_name %} {{team_name}} {% else %} 全部 {% endif %}
						<span class="caret"></span>
					</a>
					<ul class="dropdown-menu" role="menu">
						{% for team in teams %}
						<li>
							<a href="/issue?team={{team.name}}">{{team.name}}</a>
						</li>
						{% endfor %}
						<li role="presentation" class="divider"></li>
						<li>
							<a href="/issue">全部</a>
						</li>

					</ul>
				</li>
			</ul>

			<div class="topbar navbar-right">
				<span class="navbar-text ">
					<a href="/manage/user" class="navbar-link">
						<span class="glyphicon glyphicon-user"></span>
						{{user.name}}
					</a>
				</span>
				<span class="navbar-text ">
					<a href="#create" class="navbar-link">
						<span class="glyphicon glyphicon-plus"></span>
						创建问题
					</a>
				</span>
				<span class="navbar-text ">
					<a href="/issue/export" class="navbar-link">
						<span class="glyphicon glyphicon-export"></span>
						导出列表
					</a>
				</span>
			</div>
		</div>
	</nav>

	<!--  list container  -->
	<div>
		<table class="table table-hover table-condensed">
			<thead>
				<tr>
					<th style="width: 2%;">#</th>
					<th style="width: 8%;">局点</th>
					<th style="width: 28%;">问题描述</th>
					<th style="width: 8%;">产品</th>
					<th style="width: 9%;">版本</th>
					<th style="width: 6%;">接口人</th>
					<th style="width: 8%;">提交时间</th>
					<th style="width: 5%;">责任人</th>
					<th style="width: 5%;">状态</th>
					<th style="width: 18%;">跟踪记录</th>
					<th style="width: 3%;">操作</th>
				</tr>
			</thead>
			<tbody>
				{% for issue in issues %}
				<tr class="issue-{{ issue.status.lower() }}">
					<th scope="row">{{ issue.id }}</th>
					<td>{{ issue.site }}</td>
					<td>{{ issue.desc }}</td>
					<td>{{ issue.product }}</td>
					<td>{{ issue.version }}</td>
					<td>{{ issue.liaison }}</td>
					<td>{{ issue.create_time }}</td>
					<td>{{ issue.responsible }}</td>
					<td>{{ issue.status }}</td>
					<td>
						{% for t in issue.tracks %}
						<p >
							<span class="track-record">{{t.time}}</span>
							{{t.content}}
						</p>
						{% endfor %}
					</td>
					<td>
						<a tabindex="0" class="btn btn-xs btn-default my-popover" role="button" data-toggle="popover" data-placement="left" data-html="true" 
						data-content='<a href="/issue/{{ issue.id }}/edit" class="btn btn-xs btn-success" >
							<span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
							更新
						</a>
						{% if issue.status == 'Open' %}
						<a  href="/issue/{{ issue.id }}/close" class="btn btn-xs btn-default" >
							<span class="glyphicon glyphicon-off" aria-hidden="true"></span>
							关闭
						</a>
						{% else %}
						<a  href="/issue/{{ issue.id }}/open" class="btn btn-xs btn-default" >
							<span class="glyphicon glyphicon-off" aria-hidden="true"></span>
							打开
						</a>
						{% endif %}
						<a onclick="onIssueDel({{ issue.id }})" class="btn btn-xs btn-danger" >
							<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
							删除
						</a>
						' 
						data-trigger="focus" >
						<span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
					</a>
				</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>

	<div id="create" class="modalDialog">
		<form role="form" action="/issue/add" method="POST" id="login-form" autocomplete="off">
			<div class="modal-content2">
				<div class="page-header">
					<h2>局点问题</h2>
				</div>
				<div class="form-info-create">

					<div class="form-group">
						<label for="site" class="label-title">局点</label>
						<input type="text"  name="site" class="form-control" />
					</div>

					<div class="form-group">
						<label for="desc" class="label-title">问题描述</label>
						<textarea class="form-control"  name="desc" rows="3"></textarea>
					</div>

					<div class="form-group">
						<div class="row">
							<div class="col-lg-3">
								<label for="liaison" class="label-title">接口人</label>
								<input type="text"  name="liaison" class="form-control" ></div>
							<div class="col-lg-3">
								<label for="create_time" class="label-title">提交时间</label>
								<input type="text"  name="create_time" class="form-control" ></div>

							<div class="col-lg-3">
								<label for="team" class="label-title">责任项目组</label>
								<select  name="team" class="form-control" >
									{% for team in teams %}
									<option{% if loop.index0 == 0 %} selected{% endif %}>{{team.name}}</option>
									{% endfor %}
								</select>
							</div>

							<div class="col-lg-3">
								<label for="responsible" class="label-title">责任人</label>
								<input type="text" name="responsible" class="form-control" />
							</div>
						</div>
					</div>

					<div class="form-group">
						<div class="row" >
							<div class="col-lg-6">

								<label for="product" class="label-title">产品</label>
								<input type="text" name="product" class="form-control" />
							</div>
							<div class="col-lg-6">
								<label for="version" class="label-title">版本</label>
								<input type="text"  name="version" class="form-control"  />
							</div>
						</div>
					</div>

				</div>

				<div class="footer  pull-right">
					<button type="submit" class="btn btn-lg btn-primary"> <i class="glyphicon glyphicon-ok-circle"></i>
						创建
					</button>

					<a href="#" class="btn btn-lg btn-default"> <i class="glyphicon glyphicon-remove-circle"></i>
						取消
					</a>
				</div>
			</div>
			<div class="overlay"></div>
		</div>
	</form>

</div>

<div id= "del" class="modal fade">
	<div class="modal-dialog modal-sm">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title">删除问题</h4>
			</div>
			<div class="modal-footer">
				<a  class="btn btn-default" data-dismiss="modal">取消</a>
				<a  class="btn btn-danger btn-del-confirm">删除</a>
			</div>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>
<!-- /.modal -->
</body>

<script type="text/javascript">
		$(".my-popover").popover();



		function onToolClick(e){
			var id=e.getAttribute("data-id");
			var name=e.getAttribute("data-name");
			alert("Id: "+id+" ; Name: "+name);
		}

		function onIssueDel(id){
			$('#del').modal('show').show(function(){
				$(".btn-del-confirm").attr('href','/issue/'+id + '/del');
			});
		}

	</script>
</html>